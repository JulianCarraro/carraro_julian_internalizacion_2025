<ion-content [fullscreen]="true" class="anonimo-content">
  <div class="background-pattern"></div>

  <div *ngIf="isLoading" class="div-spinner">
    <ion-spinner name="circular" class="spinner-anonimo"></ion-spinner>
  </div>

  <div class="anonimo-container">
    <div class="card-container">

      <div class="language-flag" (click)="mapVisible = true">
        <img [src]="'assets/flags/' + currentLang + '.svg'" style="width: 36px;
    height: 30px;
    border-radius: 4px;" [alt]="currentLang" />
      </div>

      <div class="mapa-modal" *ngIf="mapVisible">
        <div class="modal-backdrop" (click)="mapVisible = false"></div>
        <div class="modal-content">
          <app-mapaidioma (idiomaSeleccionado)="cambiarIdioma($event)" (cerrar)="mapVisible = false">
          </app-mapaidioma>
        </div>
      </div>
      <div class="encabezado">
        <h1 class="titulo">{{ textos[currentLang].titulo }}</h1>
        <p class="subtitulo">{{ textos[currentLang].subtitulo }}</p>
      </div>

      <form [formGroup]="formData" class="formulario">
        <!-- Foto de perfil -->
        <div class="photo-section">
          <ion-label position="stacked" class="etiqueta-foto">{{ textos[currentLang].foto }}</ion-label>
          <div class="photo-box" (click)="takePhoto()"
            [class.invalid]="foto?.invalid && (foto?.touched || formSubmitted)">
            <img *ngIf="photoPreview; else cameraIcon" [src]="photoPreview" />
            <ng-template #cameraIcon>
              <div class="camera-icon-container">
                <ion-icon name="camera" class="camera-icon"></ion-icon>
                <div class="photo-label">{{ textos[currentLang].agregarFoto }}</div>
              </div>
            </ng-template>
          </div>
          <div *ngIf="foto?.invalid && (foto?.touched || formSubmitted)" class="error-message"
            style="text-align: center;">
            <ion-text color="danger">{{ fotoError }}</ion-text>
          </div>
        </div>

        <!-- Nombre -->
        <div class="form-group">
          <ion-label position="stacked" class="etiqueta">{{ textos[currentLang].nombre }}</ion-label>
          <ion-item lines="none" class="item-formulario">
            <ion-input formControlName="nombre" type="text" placeholder="{{ textos[currentLang].placeholderNombre }}"
              class="input-anonimo" [class.invalid]="nombre?.invalid && (nombre?.touched || formSubmitted)"></ion-input>
            <ion-icon name="person" slot="start" class="input-icon"></ion-icon>
          </ion-item>
          <div *ngIf="nombre?.invalid && (nombre?.touched || formSubmitted)" class="error-message">
            <ion-text color="danger">{{ nombreError }}</ion-text>
          </div>
        </div>

        <!-- Botón de envío -->
        <ion-button class="boton-anonimo" (click)="submitForm()" expand="block" [disabled]="isLoading">
          <ion-icon name="checkmark-circle" slot="start"></ion-icon>
          {{ textos[currentLang].continuar }}
        </ion-button>
      </form>
    </div>
  </div>
</ion-content>